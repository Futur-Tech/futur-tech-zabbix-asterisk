zabbix_export:
  version: '5.2'
  date: '2021-04-06T07:29:59Z'
  groups:
    -
      name: Templates
  templates:
    -
      template: TurboSMTP
      name: TurboSMTP
      description: |
        TurboSMTP API service monitoring template by InitZero
        
        https://github.com/ugoviti/zabbix-templates/tree/master/turbosmtp
        
        Version: 1.0.1 - Date: 20210406
      groups:
        -
          name: Templates
      applications:
        -
          name: TurboSMTP
      items:
        -
          name: 'Emails Sent (this month)'
          key: 'turbosmtp[emails.count.month,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          trends: 1095d
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Sent (previous month)'
          key: 'turbosmtp[emails.count.month.previous,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 1d
          trends: 1095d
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Sent (today)'
          key: 'turbosmtp[emails.count.today,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          applications:
            -
              name: TurboSMTP
          triggers:
            -
              expression: '({last()}-{min(1h)})>{$TURBOSMTP.THRESHOLD.HOURLY}'
              name: 'TurboSMTP hourly send rate threshold exceded (> {$TURBOSMTP.THRESHOLD.HOURLY})'
              priority: WARNING
              description: |
                TurboSMTP account: {$TURBOSMTP.USERNAME}
                
                max: ({mon01.initzero.it:turbosmtp[emails.count.today,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}].max(1h)}
                
                min: {mon01.initzero.it:turbosmtp[emails.count.today,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}].min(1h)})
                
                threshold: {$TURBOSMTP.THRESHOLD.HOURLY}
              manual_close: 'YES'
        -
          name: 'Emails Delivered (today)'
          key: 'turbosmtp[emails.count.today.delivered,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Failed (today)'
          key: 'turbosmtp[emails.count.today.failed,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Read (today)'
          key: 'turbosmtp[emails.count.today.read,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Sent (this week)'
          key: 'turbosmtp[emails.count.week,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 30m
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Sent (previous week)'
          key: 'turbosmtp[emails.count.week.previous,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 1d
          applications:
            -
              name: TurboSMTP
        -
          name: 'Emails Quota Limit (monthly)'
          key: 'turbosmtp[plans.smtp_limit,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
          delay: 1d
          applications:
            -
              name: TurboSMTP
      macros:
        -
          macro: '{$TURBOSMTP.PASSWORD}'
          description: 'TurboSMTP Password'
        -
          macro: '{$TURBOSMTP.QUOTA.WARN.LIMIT}'
          value: '90'
          description: '% of monthly send quota limit before triggering alarm'
        -
          macro: '{$TURBOSMTP.THRESHOLD.HOURLY}'
          value: '100'
          description: 'Hourly max sending mail threshold'
        -
          macro: '{$TURBOSMTP.USERNAME}'
          description: 'TurboSMTP Username (Email Address)'
      dashboards:
        -
          name: TurboSMTP
          widgets:
            -
              type: GRAPH_CLASSIC
              width: '12'
              height: '5'
              fields:
                -
                  type: GRAPH
                  name: graphid
                  value:
                    name: 'Emails Sent Today'
                    host: TurboSMTP
            -
              type: GRAPH_CLASSIC
              'y': '5'
              width: '12'
              height: '5'
              fields:
                -
                  type: GRAPH
                  name: graphid
                  value:
                    name: 'Emails Sent by Week'
                    host: TurboSMTP
            -
              type: GRAPH_CLASSIC
              x: '12'
              width: '12'
              height: '5'
              fields:
                -
                  type: GRAPH
                  name: graphid
                  value:
                    name: 'Emails Sent by Month'
                    host: TurboSMTP
  triggers:
    -
      expression: '(100/{TurboSMTP:turbosmtp[plans.smtp_limit,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}].last(0)})*{TurboSMTP:turbosmtp[emails.count.month,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}].last(0)}>{$TURBOSMTP.QUOTA.WARN.LIMIT}'
      name: 'TurboSMTP sent emails quota warning (> {$TURBOSMTP.WARN.LIMIT})'
      priority: WARNING
      description: 'TurboSMTP account: {$TURBOSMTP.USERNAME}'
  graphs:
    -
      name: 'Emails Sent by Month'
      show_work_period: 'NO'
      show_triggers: 'NO'
      graph_items:
        -
          sortorder: '1'
          color: 2774A4
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.month,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
        -
          sortorder: '2'
          color: F7941D
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.month.previous,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
    -
      name: 'Emails Sent by Week'
      graph_items:
        -
          sortorder: '1'
          color: F63100
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.week,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
        -
          sortorder: '2'
          color: 199C0D
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.week.previous,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
    -
      name: 'Emails Sent Today'
      show_work_period: 'NO'
      show_triggers: 'NO'
      graph_items:
        -
          sortorder: '1'
          color: 6C59DC
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.today.delivered,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
        -
          sortorder: '2'
          color: C7A72D
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.today.failed,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
        -
          sortorder: '3'
          color: BA2A5D
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.today.read,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
        -
          sortorder: '4'
          color: F230E0
          item:
            host: TurboSMTP
            key: 'turbosmtp[emails.count.today,{$TURBOSMTP.USERNAME},{$TURBOSMTP.PASSWORD}]'
